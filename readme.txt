元素法典写経(ローカル用)
2022-10-20


* ファイル

- readme.txt これ。説明書。
- names.txt 番号と名前の対応表。
- prompts/*.txt 元素法典を出力した時に吐かれるparamters文字列
- prompts/*.png PNG Info用の画像
- prompts/*.json Random Choice Script用のjson
- 768x512/*.json jsonを最大768x512まで縮小したもの(VRAM 4GB対応)

番号と巻数の対応
- 00?? 1巻
- 01?? 1.5巻


* あそびかた

手編集のとき
1. 1111 の PNG Info タブを開いて画像をドロップする
2. Send to txt2imgを押す
3. txt2imgタブを開いて Generate ボタンを押す

自動で出したいとき
1. Random Choice Scriptをインストールする
2. webui直下のpromptsにjsonをコピーする
3. txt2imgの左下のScriptでうんこする

Samplerの指定がうまく動かないのでjsonから泣く泣く外しました。

names.txtは、Notepad++などのUnicode対応エディタで開いてください。


* 作業内容

(改変ベースとしての)習作目的なので多少いじってます

法典を開きプロンプトをコピペ
添付画像を開き縦横サイズを確認
設定を入力して1枚生成
右下に出た文字列をコピペしてtxtに保存
txtからjsonとpngに変換

Seed値は手元の動作確認時にランダムで付与したもの
シードガチャはしていないので良い絵とは限らない

数値が範囲で示されてるものは中央値を採用した

{}がひとつでもあればローカル用スクリプトに変換
()と{}の混在のものも変換したが意図通りかは不明
()をエスケープしたほうが良さそうなパターンはそうした

かっこの数が合わない時は減らす側に修正
先頭のowresはコピペミスとみなしてlowresに修正
その他細かいスペルチェックはしていません

末尾のカンマは取り除いてしまっている
これは生成結果に影響あり

以下は1巻のみ(1.5巻からはUnicodeごとコピペ)
プロンプトの改行はスペースに変換
スペースのC2A0は20に変換
全角カンマと全角かっこは半角に変換
以上は生成結果に影響なし


* 作品ごとの備考

Sampler の指定が無いものは Euler a
Steps の指定が無いものは 28
CFG Scale の指定が無いものは 7
Model hashは指定があっても 925997e9
を使用しています

0005 砂、Sampler、Steps指定なし
0006 骨、Sampler、Steps指定なし
0009 ロボ、縦横サイズが2K超えだったので半分にした
0012 男
0015 縦768
0016 :2.5という指定は効いてないので削除、設定なし
0017 指定は横512だったけど画像の横768を採用
0025 サンプルは無人だったけど女の子が出た
0032 ロボ、縦横サイズが4K超えだったので1/4にした
0034 骨だけど手元ではうまくいかない
0038 甲冑女
0041 無人
0042 無人、縦横サイズが2.8Kだったので1/4にした
0049 ロボ、縦横サイズが4K超えだったので1/4にした
0051 3072x2048指定だったが960x640に落とした
0057 :2.5は削除、4864x2304指定だったが1/4に落とした

0102 Model hashがe6e8e1fc
0103 e6e8e1fc
0104 e6e8e1fc、ネガティブの一部指定が誤ってるがそのままにした
0105 e6e8e1fc
0106 Steps指定なし
0107 画像が533x332だったので768x512に変更
0108 画像が553x371だったので768x512に変更
0109 ネガティブ指定なし
0110 e6e8e1fc
0111 :1.1があるけどそのままにした
0112 画像が554x277だったので768x512に変更
0113 e6e8e1fc
0114 Samplerが通用だがeta 0.67が指定されている
0115 e6e8e1fc
0116 e6e8e1fc
0118 男、画像が481x350だったので768x512に変更
0119 画像が554x266だったので768x512に変更
0120 画像が410x205だったので768x512に変更
0121 CFG Scale、Steps指定なし、640x640に変更
0122 画像が554x369だったので768x512に変更
0123 e6e8e1fc、稳定版を採用


* 雑感

1.5巻はModel hashがe6e8e1fcのものが半数。
これはsfw版ではなくnsfwの7GBのやつらしい。
なんでfinal-prunedを使わなかったのかはわからない。

縦横サイズ指定の作品が増えた半面、
添付画像のサイズが小さくなったので、
指定してない作品がどんな大きさを意図してたかわからなくなった。

以下は1巻。

ガチャ頼りのものも多い。特にプロンプトが短いとうまく出ない。

全体的に解像度が大きめで1024くらいが基準になっている。
日本ではキャラ中心だったので512x768が主流だったイメージ。
女の子を常に小さく出すことに成功してるのは学院法(0053)で、
ほとんどのものは結局顔面アップになってしまったりする。

ロボはさらに高解像度が多いけど、手元ではアニメ少女が出る。
ひょっとすると高解像度で出さないと意図通りに出ないのかも。

プロンプト記法は必ずしも正しくなく、統一感も無い。
複数の記法が混じるのは他人の作品に手を加えるからだそうな。
半角全角なんかもごちゃ混ぜだけど動作には支障がない。

とはいえ手元で文字化けすると結構悲しいことになるので、
最新のUnicodeに対応したエディタを使いましょう。

みんなが最初からログをそのままコピペするか、
生のpngをそのまま共有してくれれば楽なんだけどなあ。


* 謝辞

元素法典
https://docs.qq.com/doc/DWHl3am5Zb05QbGVs

nai2sd-Converter
https://github.com/AUTOMATIC-gassy/nai2sd-Converter

Random Choice Script
https://github.com/hanarchy/ramdom_generation_from_json

Notepad++ Portable
https://portableapps.com/apps/development/notepadpp_portable
